<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="google-site-verification" content="VOAqlvL1BbL_Glqy47fldDLcHlz8MjARlIfftmcdios"><link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"><link rel="icon" href="/assets/favicon.ico"><meta property="og:title" content="State management in Svelte. Overlays and store."><meta property="og:type" content="website"><meta property="og:url" content="http://romanisthere.github.io/"><meta property="og:description" content="Showcase of implemented in Measureland declarative state management structure."><meta property="og:image" content="/assets/posts/svelte_state_measureland.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:src" content="http://romanisthere.github.io/assets/posts/svelte_state_measureland.jpg"><meta name="description" content="Showcase of implemented in Measureland declarative state management structure."><meta name="keywords" content="HTML, CSS, JavaScript, React, Preact, Development, Non-commerical, Open-source, Roman Smunyov, RomanistHere, PopUpoff, blog, independent, developer"><script async="" defer="defer" data-domain="romanisthere.github.io/posts" src="https://plausible.io/js/plausible.js"></script><title>State management in Svelte. Overlays and store.</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#324758"><link rel="shortcut icon" href="/favicon.ico"><style>:root{--dark-color1:#3e596c;--dark-color1:#324758;--dark-color2:#000926;--dark-color3:#1b283b;--dark-color4:#0e1f37;--blue-color1:#124e8a;--blue-color2:#2c6f86;--blue-color3:#154454;--yellow-color1:#cbcc7f;--yellow-color2:#c6b763;--gray-color:#b9b9c2;--white-color:#d7e3ff;--violet-color:#846b80;--pink-color:#99677b;--tom-color:#61718e;--jerry-color:#6e4532;--pink:pink;--def-trs:all ease .3s;--hand-font:"GloriaHallelujah";--hand-font2:"PermanentMarker";--pad-txt:30px;--bg-color2:#6ea1be;--bg-color1:#dadee0;--text-color1:#24305e;--text-color1:var(--third-bg-color);--main-bg-color:var(--dark-color1);--second-bg-color:var(--jerry-color);--third-bg-color:var(--dark-color3);--main-text-color:var(--yellow-color2);--art-fz:20px;--art-fz-title:52px;--art-fz-subtitle:25px;--art-lh:1.7;--art-lh-title:1.558;--art-lh-subtitle:1.64;--art-margin-1:34px;--art-margin-2:13px}@media screen and (max-width:1024px){:root{--art-fz:18px;--art-fz-title:47px;--art-fz-subtitle:23px;--art-lh:31px;--art-lh-title:73px;--art-lh-subtitle:38px;--art-margin-1:31px;--art-margin-2:12px}}@media screen and (max-width:735px){:root{--art-fz-title:37px;--art-lh:29px;--art-lh-title:57px;--art-lh-subtitle:36px;--art-margin-1:29px;--art-margin-2:11px}}@media screen and (max-width:360px){:root{--pad-txt:20px;--art-fz:16px;--art-fz-title:33px;--art-fz-subtitle:20px;--art-lh:26px;--art-lh-title:51px;--art-lh-subtitle:32px;--art-margin-1:26px;--art-margin-2:6px}}body,html{position:relative;width:100%;height:100%;margin:0;padding:0;background-color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;line-height:1.59;font-weight:300;font-size:18px;color:var(--main-text-color);-webkit-tap-highlight-color:transparent;background-color:var(--main-bg-color)}h1,h3{margin:0;font-weight:400}li,ul{margin:0;padding:0;list-style:none}strong{font-weight:unset}body{scrollbar-color:var(--main-text-color) var(--dark-color4)}body::-webkit-scrollbar{width:10px}body::-webkit-scrollbar-track{background:var(--dark-color4)}body::-webkit-scrollbar-thumb{background:var(--main-text-color)}.link{color:var(--text-color1);text-decoration:none;border-bottom:2px solid var(--third-bg-color);transition:var(--def-trs)}@media (hover:hover){.link:hover{color:var(--bg-color2);border-color:var(--bg-color2)}}.draw{position:fixed;top:0;left:0}.draw_popup{position:fixed;right:10px;top:100px;width:190px;transform:translateX(110%);border:8px solid var(--third-bg-color);box-shadow:5px 5px 10px 0 rgba(0,0,0,.75);background-color:var(--bg-color1);color:var(--text-color1);line-height:var(--art-lh);text-align:center}@media screen and (max-width:1024px){.draw{display:none}}.link_back{position:fixed;z-index:2;padding:10px;bottom:10px;right:10px;color:var(--txt-color2);font-family:var(--hand-font2);font-size:20px}@media screen and (max-width:1024px){.link_back{font-size:18px}}@media (hover:hover){.link_back__shadow{position:fixed;opacity:0;z-index:-1;top:0;left:0;right:0;bottom:0;transition:var(--def-trs)}}:root{--swiper-theme-color:#007aff;--swiper-navigation-size:44px}.article{position:relative;width:676px;margin:50px auto;padding:60px;border:20px solid var(--third-bg-color);box-shadow:5px 5px 10px 0 rgba(0,0,0,.75);background-color:var(--bg-color1);color:var(--text-color1);font-size:var(--art-fz);line-height:var(--art-lh)}.article__title{margin:0 0 var(--art-margin-1);font-size:var(--art-fz-title);line-height:var(--art-lh-title)}.article__subtitle,.article__title{color:var(--post-color2);font-weight:700}.article__subtitle{margin:var(--art-margin-1) 0 var(--art-margin-2);font-size:var(--art-fz-subtitle);line-height:var(--art-lh-subtitle);transition:var(--def-trs)}.article__date{margin:0;opacity:.7;text-align:right;font-weight:100}.article__img{width:100%;min-height:275px}.article__text{margin:0 0 var(--art-margin-1)}.article__col-3{border-bottom:.1em solid var(--main-text-color);background-color:rgba(198,183,99,.3)}.article__list{padding-left:22px}.article__list_item{list-style:circle}.article__img,.article__subtitle,.article__text,.article__title{content-visibility:auto;contain-intrinsic-size:600px}@media screen and (max-width:1024px){.article{padding:30px;border-width:15px;width:90%;max-width:676px;box-sizing:border-box}.article__img{min-height:235px}}@media screen and (max-width:735px){.article{margin:0;width:100%;max-width:100%;padding:var(--pad-txt) var(--pad-txt) 40px;border:none}.article__date{padding-bottom:20px}.article__img{min-height:unset}}.post{position:relative;font-weight:400}@media screen and (max-width:1024px){.post{padding-bottom:10px}.post__back{position:absolute}}@media screen and (max-width:735px){.post{padding-bottom:0}}</style><link href="/bundle.94d87.css" rel="stylesheet" media="only x" onload="this.media='all'"><noscript><link rel="stylesheet" href="/bundle.94d87.css"></noscript></head><body><noscript>You need to enable JavaScript to see this website. Come on mate, it's 2020 :).</noscript><section class="post"><aside class="draw_popup">Click to change colors Double click to reset</aside><canvas class="draw"></canvas><main class="article"><h1 class="article__title">State management in Svelte. Overlays and store.</h1><a href="https://github.com/RomanistHere/Measureland/tree/chore/migrate-to-svelte" rel="noreferrer" target="_blank" class="article__img_link"><img src="/4e12ca4228856e10c97b3f740cff5bdd.jpg" alt="State management in Svelte. Overlays and store." loading="lazy" class="article__img"></a><article class="article__text"><p class="article__text">Hi! I recently learnt Svelte and fell in love with it. So much, that I decided to move my service, Measureland, to SvelteKit. Today I want to share how I solved one of the challenges that I faced: managing overlays in the app.</p><h3 class="article__subtitle part1">How it was before.</h3><p class="article__text">There are about ten different modals or popups and a few states of sidebar plus ways to combine them. App was originally written in plain HTML, CSS and JavaScript, so it was as simple as calling <strong class="article__col-3">openPopup(popupClassName)</strong> on click. <strong class="article__col-3">openPopup</strong> function searched for the given class in DOM and added <strong class="article__col-3">"active"</strong> class to it. Simple imperative implementation. I had almost 2k strings in my <a href="https://github.com/RomanistHere/Measureland/blob/legacy/index.html" rel="noreferrer" target="_blank" class="link">index.html file</a> with all these popups there.</p><h3 class="article__subtitle part2">What we need now (challenge).</h3><p class="article__text">Svelte is declarative and component based. It means we can have a single popup component for all popups. It helps us to not repeat ourselves, but searching the DOM is not an option anymore. As well as adding a class to make modals visible. We need to do it in a declarative way. Means we need our app to know about every popup there is, so we can tell it: "hey, open this popup" - and it will. The biggest problem is that we can't call the popup1-component method from popup2-component directly. And especially if we need to call it from another component tree. (We technically can, but it's very complex to do and support).</p><h3 class="article__subtitle part3 changes">How we do it.</h3><p class="article__text">Let's start by telling our app all about the popups. I created a file: <strong class="article__col-3">overlayStateDefault.js</strong> - under constants in the lib folder (<a href="https://github.com/RomanistHere/Measureland/blob/chore/migrate-to-svelte/src/lib/constants/overlayStateDefault.js" rel="noreferrer" target="_blank" class="link">full version</a>):</p><ul class="article__list article__text"><li class="article__list_item"><strong class="article__col-3">isOpen</strong>: tells our app when we it open</li><li class="article__list_item"><strong class="article__col-3">type</strong>: tells our app what type of overlay we want to open (and close other overlays with this type)</li><li class="article__list_item"><strong class="article__col-3">data</strong>: we will most definitely want to pass data to some of the popups (instead of using global state)</li></ul><p class="article__text">Let's create superb Svelte store to make use of it (<a href="https://github.com/RomanistHere/Measureland/blob/chore/migrate-to-svelte/src/stores/state.js#L44" rel="noreferrer" target="_blank" class="link">full version</a>):</p><p class="article__text">Good. Next step is to write a few functions to work with it in a declarative way. I have <strong class="article__col-3">helpers.js</strong> file in <strong class="article__col-3">lib/utilities</strong>, let see our functions (<a href="https://github.com/RomanistHere/Measureland/blob/chore/migrate-to-svelte/src/lib/utilities/helpers.js#L93" rel="noreferrer" target="_blank" class="link">full version</a>):</p><p class="article__text">A lot of code, but nothing scary. <strong class="article__col-3">closeOverlaysWithSameType</strong> is a helper-helper function. We call it to close currently opened popup-type modals before we open a new one.</p><p class="article__text"><strong class="article__col-3">openAnotherOverlay</strong> changes <strong class="article__col-3">isOpen</strong> property of the needed modal. <strong class="article__col-3">closeOverlay</strong> changes all the <strong class="article__col-3">isOpen</strong> properties for the needed type to <strong class="article__col-3">false</strong>. <strong class="article__col-3">closeOverlays</strong> reuses our <strong class="article__col-3">overlayStateDefault</strong> object to return overlays to the default state (close all modals) saving some time and calculations.</p><p class="article__text">We have everything ready, now, how to use it in the app? Reasonable question, let's go!</p><p class="article__text">I have an <strong class="article__col-3">Overlay.svelte</strong> component used in <strong class="article__col-3">routes/index.svelte</strong> (<a href="https://github.com/RomanistHere/Measureland/blob/chore/migrate-to-svelte/src/lib/components/Overlay/Overlay.svelte" rel="noreferrer" target="_blank" class="link">full version</a>). This component has a few key points:</p><p class="article__text">The last two strings are responsible for tracking all the changes in <strong class="article__col-3">overlayStateStore</strong> (thanks to reactivity) and passing the data to needed components. For example, if some of popup-type instances is opened, <strong class="article__col-3">manageOverlays</strong> function will get its name (key) and data and pass it to <strong class="article__col-3">PopupLayer</strong> component (<a href="https://github.com/RomanistHere/Measureland/blob/chore/migrate-to-svelte/src/lib/components/Overlay/components/popups/PopupLayer.svelte" rel="noreferrer" target="_blank" class="link">full version</a>):</p><p class="article__text"><strong class="article__col-3">PopupLayer</strong>, on the other hand, has a dictionary with pairs: <strong class="article__col-3">popupName - component</strong> and <strong class="article__col-3">svelte:component</strong> construction, to load modals dynamically based on <strong class="article__col-3">popupName</strong> passed from parent component:</p><p class="article__text">That's it. The post is already too long, so let's summarize:</p><p class="article__text">Now we can open our login popup from any part of an app by calling <strong class="article__col-3">openAnotherOverlay('loginPopup')</strong> - everything else is on the side of reactivity, our helper functions and a few components. You can find the full code in <a href="https://github.com/RomanistHere/Measureland/tree/chore/migrate-to-svelte" rel="noreferrer" target="_blank" class="link">my repo</a> (migration is not finished yet).</p><p class="article__text">Feel free to contact me (<a href="mailto:romanisthere@pm.me" class="link">RomanistHere@pm.me</a>) about any questions, suggestions or improvements. We can also move all the structure to a separate module and publish it. I stream migration <a href="https://www.twitch.tv/romanisthere" rel="noreferrer" target="_blank" class="link">on Twitch</a> - come learn together!</p></article><p class="article__date">Sep 18, 2021</p></main><a href="/" class="post__back link_back">To main page</a><div class="link_back__shadow"></div></section><script type="__PREACT_CLI_DATA__">%7B%22preRenderData%22:%7B%22url%22:%22/posts/svelte-state%22,%22ogTitle%22:%22State%20management%20in%20Svelte.%20Overlays%20and%20store.%22,%22description%22:%22Showcase%20of%20implemented%20in%20Measureland%20declarative%20state%20management%20structure.%22,%22img%22:%22/assets/posts/svelte_state_measureland.jpg%22%7D%7D</script><script nomodule="">!function(){var e=document,t=e.createElement("script");if(!("noModule"in t)&&"onbeforeload"in t){var n=!1;e.addEventListener("beforeload",function(e){if(e.target===t)n=!0;else if(!e.target.hasAttribute("nomodule")||!n)return;e.preventDefault()},!0),t.type="module",t.src=".",e.head.appendChild(t),t.remove()}}();</script><script crossorigin="anonymous" src="/bundle.01ce3.esm.js" type="module"></script><script nomodule="" src="/polyfills.96e98.js"></script><script nomodule="" defer="defer" src="/bundle.d8f76.js"></script></body></html>